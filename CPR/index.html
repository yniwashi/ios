<!doctype html>
<html lang="en">
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>CPR Timer — Trial</title>
<style>
  /* ===========================
     TWEAKABLES (COLORS & SIZES)
     =========================== */
  :root{
    /* Theme core */
    --bg:#0b0d10; --fg:#e9eef3; --muted:#9aa7b3; --card:#14181d; --border:#20262d;
    --btn:#1a2027; --btn-fg:#e9eef3; --btn-border:#2b333b;
    --primary:#0f2e39; --primary-border:#2e89a8; --primary-fg:#e6fbff;
    --danger:#3a1212;  --danger-border:#7a2626;  --danger-fg:#ffecec;

    /* Timer colors */
    --total-color:#f1f5f9;     /* Total timer color */
    --cycle-color:#ff2d2d;     /* Cycle timer color */
    --adr-color:#2ea0ff;       /* Adrenaline timer color */

    /* Sizes */
    --title-size:24px;         /* "CPR Timer" title */
    --total-size:68px;         /* Total CPR Time digits */
    --kpi-title-size:16px;     /* “Cycle / Adrenaline” labels */
    --timer-size:70px;         /* Cycle/Adrenaline digits */
    --countdown-size:96px;     /* 10→1 countdown digits */
    --log-size:14px;           /* Log text size */
    --heart-diameter:220px;    /* Circle pulse overlay size */

    /* Control chip geometry */
    --chip-minw:160px;
    --chip-pad:10px 12px;
    --ctrl-gap:12px;
  }
  @media (prefers-color-scheme: light){
    :root{
      --bg:#f6f8fc; --fg:#111827; --muted:#4b5563; --card:#ffffff; --border:#e5e7eb;
      --btn:#ffffff; --btn-fg:#111827; --btn-border:#d1d5db;
      --primary:#0b6b82; --primary-border:#0b6b82; --primary-fg:#ffffff;
      --danger:#b91c1c;  --danger-border:#991b1b;  --danger-fg:#ffffff;
      --total-color:#111111;
    }
  }
  [data-theme="dark"]{
    --bg:#0b0d10; --fg:#e9eef3; --muted:#9aa7b3; --card:#14181d; --border:#20262d;
    --btn:#1a2027; --btn-fg:#e9eef3; --btn-border:#2b333b;
    --primary:#0f2e39; --primary-border:#2e89a8; --primary-fg:#e6fbff;
    --danger:#3a1212;  --danger-border:#7a2626;  --danger-fg:#ffecec;
    --total-color:#f1f5f9;
  }
  [data-theme="light"]{
    --bg:#f6f8fc; --fg:#111827; --muted:#4b5563; --card:#ffffff; --border:#e5e7eb;
    --btn:#ffffff; --btn-fg:#111827; --btn-border:#d1d5db;
    --primary:#0b6b82; --primary-border:#0b6b82; --primary-fg:#ffffff;
    --danger:#b91c1c;  --danger-border:#991b1b;  --danger-fg:#ffffff;
    --total-color:#111111;
  }

  /* ========== Base ========== */
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;font-family:system-ui,Segoe UI,Roboto,Arial;background:var(--bg);color:var(--fg)}
  .wrap{max-width:1200px;margin:0 auto;padding:14px}
  .hidden{display:none!important}

  /* Header & top controls */
  .header{display:flex;flex-direction:column;align-items:center;gap:10px}
  .title{font-weight:900;font-size:var(--title-size);letter-spacing:.2px;text-align:center}
  .trial{margin-left:6px;font-weight:800;font-size:12px;color:#8b5cf6}
  .ctrls{display:flex;gap:var(--ctrl-gap);justify-content:center;flex-wrap:wrap}
  .chip{display:flex;align-items:center;gap:10px;min-width:var(--chip-minw);justify-content:center;
        padding:var(--chip-pad);border-radius:12px;border:1px solid var(--border);background:var(--card);color:var(--muted);font-size:14px}
  .chip input{width:88px;padding:6px 8px;border-radius:8px;border:1px solid var(--border);background:var(--bg);color:var(--fg);text-align:center}
  .icon-btn{display:inline-flex;align-items:center;justify-content:center;width:46px;height:46px;border-radius:10px;border:1px solid var(--border);background:var(--card);color:var(--fg)}
  .icon{width:28px;height:28px}

  /* Total timer */
  .total-wrap{display:flex;justify-content:center;margin:8px 0 10px}
  .total-title{font-size:14px;letter-spacing:.08em;text-transform:uppercase;color:var(--muted);font-weight:900;text-align:center}
  .total-value{font-variant-numeric:tabular-nums;font-family:ui-monospace,Consolas,monospace;font-size:var(--total-size);font-weight:900;color:var(--total-color);text-align:center}

  /* Cards */
  .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:16px}

  /* KPI / timers */
  .kpi{position:relative;display:flex;flex-direction:column;align-items:center;justify-content:center;border-radius:14px;border:1px solid var(--border);padding:16px;min-height:200px}
  .label{font-size:var(--kpi-title-size);letter-spacing:.08em;text-transform:uppercase;color:var(--muted);font-weight:900}
  .value{font-variant-numeric:tabular-nums;font-family:ui-monospace,Consolas,monospace;font-size:var(--timer-size);font-weight:900}
  #cycleVal{color:var(--cycle-color)}
  #adrVal{color:var(--adr-color)}

  /* Pulse circle (heart simplified as single circle) */
  .pulse-wrap{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;pointer-events:none}
  .pulse{
    width:var(--heart-diameter); height:var(--heart-diameter); border-radius:50%;
    background:radial-gradient(circle, rgba(255,77,77,.27), rgba(179,0,0,.08) 60%, transparent 70%);
    opacity:.32; transform:scale(1); animation:beat .6s ease-in-out infinite;
  }
  @keyframes beat{0%{transform:scale(1)}50%{transform:scale(1.14)}100%{transform:scale(1)}}

  /* 10→1 countdown overlay */
  .countdown{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:transparent;
    font-family:ui-monospace,Consolas,monospace;font-size:var(--countdown-size);font-weight:900;color:var(--cycle-color);pointer-events:none}

  /* Buttons */
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:center}
  button{padding:12px 18px;border-radius:12px;border:1px solid var(--btn-border);background:var(--btn);color:var(--btn-fg);cursor:pointer}
  button:hover{filter:brightness(1.05)} button:disabled{opacity:.5;cursor:not-allowed}
  .primary{background:var(--primary); border-color:var(--primary-border); color:var(--primary-fg)}
  .danger{ background:var(--danger);  border-color:var(--danger-border);  color:var(--danger-fg)}
  .wide{min-width:160px}

  /* Actions & Log */
  .actions .row button{min-width:180px}
  ul.log{margin:10px 0 0;padding-left:20px;max-height:260px;overflow:auto;font-size:var(--log-size);line-height:1.35}
  ul.log li{margin:6px 0}

  /* WAAFELSS */
  .wa-title{font-size:22px;font-weight:900;text-align:center;margin:6px 0 10px}
  .wa-input{display:flex;justify-content:center;align-items:center;gap:12px;margin-bottom:10px}
  .wa-label{font-weight:800;color:var(--muted)}
  .wa-input input{width:200px;font-size:22px;padding:12px 14px;border-radius:10px;border:1px solid var(--border);background:var(--bg);color:var(--fg);text-align:center}
  .wa-grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px}
  @media (max-width:600px){.wa-grid{grid-template-columns:1fr}}
  .w-row{display:flex;gap:8px;align-items:center}
  .w-tag{min-width:110px;padding:6px 10px;border-radius:10px;border:1px solid var(--border);color:var(--muted)}
  .w-val{font-weight:800}

  /* ======================
     ORIENTATION LAYOUTS
     ====================== */

  /* PORTRAIT: (previous flow) – Total at top, then:
     grid: [Cycle] [Adrenaline] [Actions/Log/WAAFELSS] stacked */
  .grid{display:grid;gap:16px}
  @media (orientation:portrait){
    .grid{grid-template-columns:1fr}
  }

  /* LANDSCAPE: Cycle LEFT, Actions+Log+WAAFELSS CENTER, Adrenaline RIGHT */
  @media (orientation:landscape){
    .grid{grid-template-columns:1fr 1fr 1fr}
  }

  @media print{ .no-print{display:none!important} body{background:#fff;color:#000} .card{border:none} .total-value{color:#000} }
</style>

<body>
<div id="root" class="wrap">
  <div class="header">
    <div class="title">CPR Timer <span class="trial">Trial Version</span></div>
    <div class="ctrls">
      <div class="chip">Theme <button id="themeToggle" title="Toggle theme">Auto</button></div>
      <div class="chip">BPM <input id="bpm" type="number" min="60" max="160" step="1" value="110"></div>
      <div class="chip" style="gap:12px">
        <span>Beat</span>
        <button id="btnUnmute" class="icon-btn" title="Unmute beat" aria-label="Unmute beat">
          <svg class="icon" viewBox="0 0 24 24" fill="none"><path d="M3 9v6h4l5 4V5L7 9H3z" stroke="currentColor" stroke-width="2"/></svg>
        </button>
        <button id="btnMute" class="icon-btn hidden" title="Mute beat" aria-label="Mute beat">
          <svg class="icon" viewBox="0 0 24 24" fill="none"><path d="M3 9v6h4l5 4V5L7 9H3z" stroke="currentColor" stroke-width="2"/><path d="M16 9l5 6M21 9l-5 6" stroke="currentColor" stroke-width="2"/></svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Total CPR Time -->
  <div class="total-wrap">
    <div>
      <div class="total-title">Total CPR Time</div>
      <div id="totalVal" class="total-value">00:00</div>
    </div>
  </div>

  <div class="grid">
    <!-- Cycle -->
    <div class="card">
      <div class="kpi" id="cycleBox">
        <div class="label">Cycle</div>
        <div id="cycleVal" class="value">00:00</div>
        <div class="pulse-wrap"><div id="pulse" class="pulse"></div></div>
        <div id="countdown" class="countdown hidden">10</div>
      </div>
      <div class="row no-print" style="margin-top:12px">
        <button id="btnStart" class="primary wide">Start CPR</button>
        <button id="btnPause"            class="wide">Pause CPR</button>
        <button id="btnStop"  class="danger wide">Stop</button>
      </div>
    </div>

    <!-- Actions + Log + WAAFELSS -->
    <div class="card">
      <div class="row">
        <button id="btnShock" class="wide">Shock</button>
        <button id="btnAmio"  class="wide">Amiodarone</button>
        <button id="btnROSC"  class="danger wide">ROSC</button>
      </div>
      <div class="row no-print" style="margin-top:10px">
        <button id="btnExport" class="wide">Export .txt</button>
        <button id="btnPrint"  class="wide">Print (PDF)</button>
      </div>
      <ul id="log" class="log"></ul>

      <div class="wa-title">WAAFELSS</div>
      <div class="wa-input no-print">
        <span class="wa-label">Age</span>
        <input id="ageInput" type="number" min="0" placeholder="Enter age">
        <button id="monthsBtn">Months</button>
        <button id="yearsBtn">Years</button>
      </div>
      <div class="card" style="margin-top:10px">
        <div class="wa-grid">
          <div class="w-row"><div class="w-tag">Age</div><div id="wAge" class="w-val">—</div></div>
          <div class="w-row"><div class="w-tag">Weight</div><div id="wWeight" class="w-val">—</div></div>
          <div class="w-row"><div class="w-tag">Adrenaline</div><div id="wAdr" class="w-val">—</div></div>
          <div class="w-row"><div class="w-tag">Amiodarone</div><div id="wAmio" class="w-val">—</div></div>
          <div class="w-row"><div class="w-tag">Fluids</div><div id="wFluids" class="w-val">—</div></div>
          <div class="w-row"><div class="w-tag">SGA</div><div id="wSGA" class="w-val">—</div></div>
          <div class="w-row"><div class="w-tag">Energy</div><div id="wJoules" class="w-val">—</div></div>
          <div class="w-row"><div class="w-tag">D10%</div><div id="wD10" class="w-val">—</div></div>
        </div>
      </div>
    </div>

    <!-- Adrenaline -->
    <div class="card">
      <div class="kpi">
        <div class="label">Adrenaline</div>
        <div id="adrVal" class="value">00:00</div>
      </div>
      <div class="row no-print" style="margin-top:12px">
        <button id="btnAdrStart" class="wide">Start Adrenaline</button>
        <button id="btnAdrPause" class="wide" disabled>Pause Adrenaline</button>
      </div>
    </div>
  </div>
</div>

<script>
(() => {
  /* ======= Theme ======= */
  const root=document.documentElement, themeBtn=document.getElementById('themeToggle');
  let themeState='auto'; function applyTheme(){ root.removeAttribute('data-theme'); if(themeState==='light')root.dataset.theme='light'; if(themeState==='dark')root.dataset.theme='dark'; themeBtn.textContent=themeState[0].toUpperCase()+themeState.slice(1); }
  themeBtn.onclick=()=>{ themeState=themeState==='auto'?'light':themeState==='light'?'dark':'auto'; applyTheme(); }; applyTheme();

  /* ======= Helpers ======= */
  const $=id=>document.getElementById(id);
  const fmt=s=>{ s=Math.max(0,Math.floor(s)); const m=String((s/60|0)).padStart(2,'0'); return `${m}:${String(s%60).padStart(2,'0')}`; };
  const time24=d=>d.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit', second:'2-digit', hour12:false});
  const logEl=$('log'), events=[];
  function stamp(label){ const ts=new Date(); const li=document.createElement('li'); li.textContent=`${time24(ts)} | ${label}`; logEl.prepend(li); events.push({ts,label}); }

  /* ======= Wake Lock ======= */
  let wakeLock=null; async function requestWakeLock(){ try{ if('wakeLock'in navigator){ wakeLock = await navigator.wakeLock.request('screen'); }}catch{} }
  async function releaseWakeLock(){ try{ if(wakeLock){ await wakeLock.release(); wakeLock=null; } }catch{} }
  document.addEventListener('visibilitychange',()=>{ if(document.visibilityState==='visible' && (running||adrRunning)) requestWakeLock(); });

  /* ======= Audio ======= */
  let audioCtx; const buffers={};
  const soundFiles={ beat:'beat.wav', start:'start.wav', pause:'pause.wav', stop:'stop.wav', adr4:'adr4.wav', cpr90:'cpr90.wav', cpr120:'cpr120.wav' };
  async function ensureAudio(){ if(!audioCtx) audioCtx=new (window.AudioContext||window.webkitAudioContext)(); await audioCtx.resume(); if(!buffers._loaded){ for(const[k,p] of Object.entries(soundFiles)){ try{ const r=await fetch(p); const a=await r.arrayBuffer(); buffers[k]=await audioCtx.decodeAudioData(a);}catch{} } buffers._loaded=true; } }
  function play(name,gain=1){ const b=buffers[name]; if(!audioCtx||!b) return; const src=audioCtx.createBufferSource(), g=audioCtx.createGain(); g.gain.value=gain; src.buffer=b; src.connect(g).connect(audioCtx.destination); src.start(); }

  /* Beat (mute only for beat) */
  let beatMuted=false, beatTimer=null, bpm=+$('bpm').value||110;
  $('bpm').addEventListener('change',e=>{ bpm=+e.target.value||110; setPulseBpm(bpm); if(running) restartBeat(); });
  function startBeat(){ clearInterval(beatTimer); if(beatMuted) return; const iv=Math.max(200, 60000/Math.max(1,bpm)); beatTimer=setInterval(()=>play('beat',0.9), iv); }
  function stopBeat(){ clearInterval(beatTimer); beatTimer=null; }
  function restartBeat(){ stopBeat(); startBeat(); }
  $('btnUnmute').onclick=async()=>{ beatMuted=false; $('btnUnmute').classList.add('hidden'); $('btnMute').classList.remove('hidden'); if(running){ await ensureAudio(); startBeat(); } };
  $('btnMute').onclick  =()=>{ beatMuted=true;  $('btnMute').classList.add('hidden');   $('btnUnmute').classList.remove('hidden'); stopBeat(); };

  /* Pulse speed = BPM */
  function setPulseBpm(b){ const dur=Math.max(.25, 60/Math.max(1,b)); $('pulse').style.animationDuration=dur+'s'; }
  setPulseBpm(bpm);

  /* ======= State ======= */
  let running=false;
  let startedWall=0, endedWall=0;

  // Cycle (per-cycle cues)
  let cycleStart=0, cyclePausedAt=0, cyclePausedAccum=0;
  let inCountdown=false, countdownLeft=10, cdTimer=null;
  let cue90=false, cue120=false; // reset each cycle

  // Adrenaline
  let adrRunning=false, adrStart=0, adrPausedAt=0, adrPausedAccum=0;

  /* ======= Loop ======= */
  function nowMs(){ return Date.now(); }
  function loop(){
    const now=nowMs();

    // Total (never pauses — only stops on Stop)
    if(startedWall && !endedWall) $('totalVal').textContent=fmt((now-startedWall)/1000);
    else if(startedWall && endedWall) $('totalVal').textContent=fmt((endedWall-startedWall)/1000);
    else $('totalVal').textContent='00:00';

    // Cycle
    if(cycleStart && !inCountdown){
      const cyc = running ? (now - cycleStart - cyclePausedAccum)/1000
                          : (cyclePausedAt ? (cyclePausedAt - cycleStart - cyclePausedAccum)/1000 : 0);
      $('cycleVal').textContent = fmt(Math.max(0,cyc|0));
      // cue at 90s and 120s
      if(running && !cue90  && cyc>=90){ cue90=true;  play('cpr90'); }
      if(running && !cue120 && cyc>=120){ cue120=true; play('cpr120'); startCountdown(); }
    }

    // Adrenaline (auto-reset each 4:00)
    if(adrStart){
      const a = adrRunning ? (now - adrStart - adrPausedAccum)/1000
                           : (adrPausedAt ? (adrPausedAt - adrStart - adrPausedAccum)/1000 : 0);
      $('adrVal').textContent = fmt(Math.max(0,a|0));
      if(adrRunning && a>=240){ play('adr4'); adrStart=now; adrPausedAccum=0; adrPausedAt=0; }
    } else $('adrVal').textContent='00:00';

    requestAnimationFrame(loop);
  }
  requestAnimationFrame(loop);

  /* ======= 10→1 countdown overlay ======= */
  function startCountdown(){
    inCountdown=true; countdownLeft=10;
    $('cycleVal').classList.add('hidden');
    const cd=$('countdown'); cd.textContent=String(countdownLeft); cd.classList.remove('hidden');
    clearInterval(cdTimer);
    cdTimer=setInterval(()=>{
      countdownLeft--;
      if(countdownLeft<=0){
        clearInterval(cdTimer);
        cd.classList.add('hidden');
        $('cycleVal').classList.remove('hidden');
        // Restart a fresh cycle & reset cues; play start sound
        cycleStart=nowMs(); cyclePausedAccum=0; cyclePausedAt=0;
        cue90=false; cue120=false;
        inCountdown=false; play('start');
      } else cd.textContent=String(countdownLeft);
    },1000);
  }

  /* ======= CPR controls ======= */
  $('btnStart').onclick = async () => {
    await ensureAudio();
    if(!startedWall){
      startedWall=nowMs(); cycleStart=startedWall; cyclePausedAccum=0; cyclePausedAt=0; inCountdown=false; cue90=false; cue120=false;
      stamp('CPR Timer Started'); play('start'); requestWakeLock();
    } else if(cyclePausedAt){
      const d=nowMs()-cyclePausedAt; cyclePausedAccum+=d; cyclePausedAt=0; stamp('CPR Timer Resumed'); play('start'); requestWakeLock();
    }
    endedWall=0; running=true; setPulseBpm(bpm); if(!beatMuted) startBeat();
  };

  $('btnPause').onclick = async () => {
    if(!running) return;
    await ensureAudio();
    running=false; cyclePausedAt=nowMs(); stamp('CPR Timer Paused'); play('pause'); stopBeat();
  };

  $('btnStop').onclick = async () => {
    await ensureAudio(); play('stop');
    // fully reset
    running=false; inCountdown=false; clearInterval(cdTimer);
    startedWall=0; endedWall=0;
    cycleStart=0; cyclePausedAt=0; cyclePausedAccum=0; cue90=false; cue120=false;
    adrRunning=false; adrStart=0; adrPausedAt=0; adrPausedAccum=0;
    $('countdown').classList.add('hidden'); $('cycleVal').classList.remove('hidden');
    $('totalVal').textContent='00:00'; $('cycleVal').textContent='00:00'; $('adrVal').textContent='00:00';
    stopBeat(); releaseWakeLock();
    stamp('CPR Timers Reset');
  };

  /* ======= Adrenaline controls ======= */
  $('btnAdrStart').onclick = async () => {
    await ensureAudio();
    if(!startedWall) $('btnStart').click(); // auto-start cycle & sound
    if(!adrStart){ adrStart=nowMs(); adrPausedAccum=0; adrPausedAt=0; adrRunning=true; stamp('Adrenaline Timer Started'); }
    else if(adrPausedAt){ const d=nowMs()-adrPausedAt; adrPausedAccum+=d; adrPausedAt=0; adrRunning=true; stamp('Adrenaline Timer Resumed'); }
    $('btnAdrPause').disabled=false;
  };
  $('btnAdrPause').onclick = ()=>{ if(!adrRunning) return; adrRunning=false; adrPausedAt=nowMs(); stamp('Adrenaline Timer Paused'); };

  /* ======= Actions ======= */
  $('btnShock').onclick = ()=>{ const n=(window.__shock=(window.__shock||0)+1); stamp(`Shock no. ${n} Delivered`); };
  $('btnAmio').onclick  = ()=>{ const n=(window.__amio =(window.__amio ||0)+1); stamp(`Amiodarone no. ${n} Administered`); };
  $('btnROSC').onclick  = ()=>{ stamp('ROSC Achieved'); };

  /* ======= Export / Print ======= */
  function exportLines(){
    const started = startedWall ? new Date(startedWall).toLocaleString([], {hour12:false}) : 'N/A';
    const ended   = endedWall   ? new Date(endedWall).toLocaleString([], {hour12:false})   : 'N/A';
    const total   = (startedWall && endedWall) ? fmt((endedWall-startedWall)/1000) : '—';
    const counts  = `Shocks: ${window.__shock||0}; Amio: ${window.__amio||0}`;
    const lines   = [`CPR SESSION REPORT`,`Started: ${started}`,`Ended:   ${ended}`,`BPM (beat): ${bpm}`,`Total: ${total}`,counts,``,`Events:`];
    for (const e of events) lines.push(`${time24(e.ts)} | ${e.label}`);
    return lines;
  }
  $('btnExport').onclick=()=>{ const blob=new Blob([exportLines().join('\n')],{type:'text/plain'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=`cpr_report_${new Date().toISOString().replace(/[:.]/g,'-')}.txt`; a.click(); };
  $('btnPrint').onclick =()=>{ const html=`<!doctype html><meta charset="utf-8"><title>CPR Report</title><style>body{font-family:system-ui,Segoe UI,Roboto,Arial;margin:24px;color:#111}h2{margin:0 0 8px}pre{white-space:pre-wrap}</style><h2>CPR Session Report</h2><pre>${exportLines().join('\n')}</pre><script>onload=()=>{print();setTimeout(()=>close(),300)}<\/script>`; const w=window.open('','printwin'); w.document.open(); w.document.write(html); w.document.close(); };

  /* ======= WAAFELSS ======= */
  function clamp(v,a,b){ return Math.max(a,Math.min(b,v)); }
  function months(age){ const weight=age*0.5+4, adr=+(weight*0.01).toFixed(2), am=+(weight*5).toFixed(1); const minF=Math.round(weight*10), maxF=Math.round(weight*20); const j=Math.round(clamp(weight*4,0,360)), d=+(clamp(weight*2.5,0,50)).toFixed(1); const sga=weight<=5?'Size 1':'Size 1.5'; return {age:`${age} months`,weight,adr,amio:am,minF,maxF,joules:j,d10:d,sga}; }
  function years(age){ let weight,sga; if(age<=5){ weight=age*2+8; sga=(weight>=10&&weight<=24)?'Size 2':(weight>=25&&weight<=35)?'Size 2.5':''; } else { weight=age*3+7; sga=(weight>=25&&weight<=35)?'Size 2.5':'Consider adult SGA sizes'; } const adr=+(weight*0.01).toFixed(2), am=+(weight*5).toFixed(1); const minF=Math.round(weight*10), maxF=Math.round(weight*20); const j=Math.round(clamp(weight*4,0,360)), d=+(clamp(weight*2.5,0,50)).toFixed(1); return {age:`${age} years`,weight,adr,amio:am,minF,maxF,joules:j,d10:d,sga}; }
  function renderW(o){ $('wAge').textContent=o.age; $('wWeight').textContent=`${o.weight.toFixed(1)} kg`; $('wAdr').textContent=`${o.adr} mg`; $('wAmio').textContent=`${o.amio} mg`; $('wFluids').textContent=`${o.minF}–${o.maxF} mL`; $('wSGA').textContent=o.sga||'—'; $('wJoules').textContent=`${o.joules} J`; $('wD10').textContent=`${o.d10} mL`; }
  $('monthsBtn').onclick=()=>{ const n=+$('ageInput').value; if(isNaN(n)||n<0){alert('Enter age');return;} renderW(months(n)); };
  $('yearsBtn').onclick =()=>{ const n=+$('ageInput').value; if(isNaN(n)||n<0){alert('Enter age');return;} renderW(years(n)); };
})();
</script>
</body>
</html>
