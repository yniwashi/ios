<!DOCTYPE html>
<html lang="en" data-theme="auto">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Ambulance</title>

  <!-- Webclip / PWA friendliness -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <!-- Theme color for light/dark -->
  <meta id="theme-color" name="theme-color" content="#0f1115" />
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f9fc">
  <meta name="theme-color" media="(prefers-color-scheme: dark)"  content="#0f1115">

  <!-- Material Symbols Rounded (filled) -->
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,500,1,0" rel="stylesheet">

  <style>
    :root{ --radius:12px; --speed:.22s; --shadow:0 8px 18px rgba(0,0,0,.28); --shadow-2:0 12px 28px rgba(0,0,0,.35); --gap:8px }
    @media (prefers-color-scheme: light){ :root{
      --bg:#f7f9fc; --surface:#ffffff; --border:#e7ecf3; --text:#0c1230; --muted:#616b86;
      --accent:#1f6fff; --accent-2:#19b36b; --surface-2:#f1f5fb;
    }}
    @media (prefers-color-scheme: dark){ :root{
      --bg:#0f1115; --surface:#171a21; --border:#232a37; --text:#eef2ff; --muted:#9aa6c3;
      --accent:#2f81f7; --accent-2:#20c385; --surface-2:#12151c;
    }}
    [data-theme="light"]{ --bg:#f7f9fc; --surface:#ffffff; --border:#e7ecf3; --text:#0c1230; --muted:#616b86; --accent:#1f6fff; --accent-2:#19b36b; --surface-2:#f1f5fb }
    [data-theme="dark"] { --bg:#0f1115; --surface:#171a21; --border:#232a37; --text:#eef2ff; --muted:#9aa6c3; --accent:#2f81f7; --accent-2:#20c385; --surface-2:#12151c }

    html,body{height:100%}
    body{
      margin:0; font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Inter,system-ui,Arial,sans-serif;
      background:var(--bg); color:var(--text); -webkit-tap-highlight-color:transparent;
      padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
    }
    .wrap{max-width:980px; margin:0 auto; padding:12px clamp(8px,4vw,16px) 18px; display:flex; flex-direction:column; gap:10px}

    /* Topbar */
    .topbar{display:flex; align-items:center; justify-content:space-between; gap:10px}
    .brand{display:flex; align-items:center; gap:2px}
    .logo{ width:50px; height:50px; object-fit:contain; border-radius:6px; transform:scaleX(-1) }
    .title{ margin:0; font-size:clamp(20px,3.8vw,26px); font-weight:800; letter-spacing:.25px }
    .theme-toggle{background:var(--surface); border:1px solid var(--border); border-radius:999px; padding:4px 10px; display:flex; align-items:center; gap:8px; font-size:13px; color:var(--text)}
    .theme-toggle select{appearance:none; background:transparent; border:none; color:inherit; font:inherit; outline:none; cursor:pointer}

    /* News */
    .news{display:none; background:linear-gradient(180deg,rgba(47,129,247,.12),rgba(47,129,247,.06));
      border:1px solid color-mix(in oklab, var(--accent) 40%, transparent);
      color:color-mix(in oklab, var(--text) 85%, var(--accent));
      padding:10px 12px; border-radius:12px; line-height:1.35; animation:fadeIn .25s ease-out both}
    @keyframes fadeIn{from{opacity:0; transform:translateY(-4px)} to{opacity:1; transform:none}}

    /* Shortcuts mode row */
    .row{background:var(--surface); border:1px solid var(--border); border-radius:12px; padding:10px 12px; display:flex; align-items:center; justify-content:space-between; gap:10px}
    .copy{display:flex; flex-direction:column; gap:3px}
    .copy .t{margin:0; font-size:15px; font-weight:600}
    .copy .s{margin:0; font-size:12px; color:var(--muted)}
    .toggle{position:relative; width:56px; height:30px; flex:none}
    .toggle input{opacity:0; width:0; height:0}
    .rail{position:absolute; inset:0; border-radius:999px; background:var(--surface-2); border:1px solid var(--border); transition:background var(--speed), border var(--speed)}
    .knob{position:absolute; left:3px; top:3px; width:24px; height:24px; border-radius:50%; background:linear-gradient(180deg,#fff,#e7ecff);
      box-shadow:0 2px 6px rgba(0,0,0,.28); transition:transform var(--speed)}
    .toggle input:checked + .rail{background:linear-gradient(180deg,var(--accent-2),#0ea76a); border-color:color-mix(in oklab, var(--accent-2) 60%, var(--border))}
    .toggle input:checked + .rail .knob{transform:translateX(26px)}

    /* Sections */
    .sections{display:flex; flex-direction:column; gap:8px}
    .section{display:flex; flex-direction:column; gap:4px}
    .section-head{ display:flex; align-items:center; gap:8px; color:var(--muted); font-size:12px; font-weight:600; letter-spacing:.14em; text-transform:uppercase; padding:4px 2px 0 }
    .section-head::after{content:""; height:1px; background:var(--border); flex:1}

    /* Grid & buttons â€” wider cards */
    /* fixed-size cards (no stretch when items are hidden) */
:root{ --btn-w:108px }                                  /* portrait card width */
@media (orientation:landscape){ :root{ --btn-w:120px } } /* landscape width */

/* Fixed-size cards, dense packing, left-aligned */
.grid{
  --btnw: 160px;         /* button width  (tweak if you like) */
  --btnh: 120px;         /* button height (tweak if you like) */

  display:grid;
  gap:12px;
  /* fixed-width columns; auto-fill as many as fit */
  grid-template-columns: repeat(auto-fill, minmax(var(--btnw), var(--btnw)));
  /* fixed row height so packing works perfectly */
  grid-auto-rows: var(--btnh);
  /* pack items tightly when some are hidden */
  grid-auto-flow: row dense;
  /* left align the grid area */
  justify-content:start;
}



 .btn{
  width: var(--btnw);           /* match grid column width */
  min-height: var(--btnh);      /* match grid row height */
  display:flex; flex-direction:column; align-items:center; justify-content:center; gap:6px;
  text-decoration:none; color:var(--btn-fg,#fff);
  border-radius:12px; padding:12px 12px;
  font-size:13px; font-weight:800; letter-spacing:.2px; text-align:center;
  box-shadow:var(--shadow);
  transition:transform var(--speed), box-shadow var(--speed), filter var(--speed);
}


    .btn:hover{transform:translateY(-2px); box-shadow:var(--shadow-2)}
    .btn:active{transform:translateY(0) scale(.98)}
    .label{opacity:.98; line-height:1.12}

    /* ðŸ‘‡ per-button overrides text and bg color */
#cpr               { --btn-fg:#fff; }   /* CPR white */
#rsi-checklist     { --btn-fg:#fff; }   /* RSI Checklist white */
#bwaafelss          { --btn-fg:#fff; }   /* WAAFELSS white */

#pediatric     { --btn-fg:#fff; }   /* CCP Pediatric white */
#pediatrics     { --btn-fg:#fff; }   /* AP Pediatrics white */
#care-tools        { --btn-fg:#000000; }   /* Care Tools black */
#estimated-weight  { --btn-fg:#fff; }   /* Estimated Weight white */

#gcs-score         { --btn-fg:#fff; }   /* GCS Score white */
#apgar-score       { --btn-fg:#fff; }   /* APGAR Score white */
#sat-score         { --btn-fg:#000000; }   /* SAT Score black */

#flowcharts        { --btn-fg:#fff; }   /* Flowcharts white */
#rbs-converter     { --btn-fg:#000000; }   /* RBS Converter black */
#cpg-wizard        { --btn-fg:#fff; }   /* CPG Wizard white */
#calculate-map     { --btn-fg:#000000; }   /* Calculate MAP black */

#as-call           { --btn-fg:#000000; }   /* AS-Call black */
#hos               { --btn-fg:#fff; }   /* HOS white */
#websites          { --btn-fg:#fff; }   /* Websites white */


    /* Material icon styling */
    .material-symbols-rounded{
      font-family:'Material Symbols Rounded';
      font-weight:normal; font-style:normal; font-size:26px; line-height:1;
      display:inline-block; white-space:nowrap; direction:ltr;
      -webkit-font-feature-settings:'liga'; -webkit-font-smoothing:antialiased;
      font-variation-settings:'FILL' 1,'wght' 500,'GRAD' 0,'opsz' 24;
    }

    /* Button-specific colors (one per tool) */
.btn-cpr{background:linear-gradient(180deg,#ff5757,#e23b3b)}
.btn-rsi{background:linear-gradient(180deg,#0D5BB5,#0D3AB5)}
.btn-waafelss{background:linear-gradient(180deg,#D660C6,#D936BE)}
.btn-ccp{background:linear-gradient(180deg,#9F9FB5,#81818F)}
.btn-ap{background:linear-gradient(180deg,#4DB3FF,#0A96FA)}
.btn-caretools{background:linear-gradient(180deg,#FFB36B,#F78000)}
.btn-weight{background:linear-gradient(180deg,#C16FD9,#8E34BF)}
.btn-gcs{background:linear-gradient(180deg,#6BE65A,#1CCC0C)}
.btn-apgar{background:linear-gradient(180deg,#FF94EB,#FF5CE2)}
.btn-sat{background:linear-gradient(180deg,#FFBE82,#FF8A00)}
.btn-flowcharts{background:linear-gradient(180deg,#66D9FF,#00B3FF)}
.btn-rbs{background:linear-gradient(180deg,#FFF9A6,#FFF200)}
.btn-cpg{background:linear-gradient(180deg,#7AEB7A,#02C202)}
.btn-map{background:linear-gradient(180deg,#FFAC75,#FF6600)}
.btn-ascall{background:linear-gradient(180deg,#FFEA94,#FFDB00)}
.btn-hos{background:linear-gradient(180deg,#577CE6,#003DEB)}
.btn-websites{background:linear-gradient(180deg,#64748b,#475569)}


    /* Panel */
    #panel{ position: fixed; inset: 0; background: transparent; z-index: 9999; }
    #panel[hidden]{ display:none }
    #panel-card{ position: relative; width: 100vw; height: 100dvh; overflow: auto; background: var(--bg); border: 0; border-radius: 0; box-shadow: 0 10px 30px rgba(0,0,0,.35); -webkit-overflow-scrolling: touch; transform: translateZ(0) translateX(0); transition: transform 300ms cubic-bezier(.22,.61,.36,1); will-change: transform; }
    .panel-head{ position: sticky; top: 0; display: flex; align-items: center; gap: 10px; padding: calc(env(safe-area-inset-top) + 6px) 12px 8px 12px; background: var(--bg); border-bottom: 1px solid var(--border); z-index: 1; }
    .backbtn{ appearance: none; cursor: pointer; padding: 8px 12px; border-radius: 10px; background: var(--surface-2); border: 1px solid var(--border); color: var(--text); font-weight: 800; font-size: 14px; }
    .panel-title{ margin: 0; font-size: 15px; font-weight: 800 }
    body.panel-open .wrap{ transition: transform 300ms ease, opacity 300ms ease; }
  </style>
</head>
<body>
  <div class="wrap">
    <!-- Topbar -->
    <div class="topbar">
      <div class="brand">
        <img class="logo" src="images/logo.png" alt="Ambulance Logo">
        <h1 class="title">Ambulance</h1>
      </div>
      <div class="theme-toggle">
        <span style="font-weight:600">Theme</span>
        <select id="themeSelect" aria-label="Theme">
          <option value="auto">Auto</option>
          <option value="light">Light</option>
          <option value="dark">Dark</option>
        </select>
      </div>
    </div>

    <!-- News -->
    <div id="news" class="news"></div>

    <!-- Shortcuts Mode -->
    <div class="row">
      <div class="copy">
        <p class="t">Shortcuts Mode</p>
        <p class="s">Enable to run actions in the Shortcuts app. When off, items open in the Ambulance app and some features may be limited.</p>
      </div>
      <label class="toggle" aria-label="Toggle Shortcuts Mode">
        <input id="mode" type="checkbox" />
        <div class="rail"><div class="knob"></div></div>
      </label>
    </div>

    <!-- Sections container -->
    <div id="sections" class="sections"></div>
  </div>

  <!-- Results Panel (webapp view) -->
  <section id="panel" hidden>
    <div id="panel-card">
      <div class="panel-head">
        <button id="panel-back" class="backbtn">Back</button>
        <h3 id="panel-title" class="panel-title">Tool</h3>
      </div>
      <div id="panel-body"></div>
    </div>
  </section>

  <script type="module">
    /* =========================
         CONFIG
       ========================= */
    const NEWS_MESSAGE = "";
    const SHORTCUT_NAME = "Ambulance";
    const SEPARATOR     = "::";
    const USE_RETURN_URL = false;
    const RETURN_URL    = "https://yourdomain.com/done.html";

    
    const BUTTONS = [
  // Row 1 â€” Resuscitation & Timers
  { text:"CPR",              iconType:"material", icon:"monitor_heart",       color:"btn-cpr",       href:"https://ios.niwashibase.com/cpr", showDefault:true, showShortcuts:false },
  { text:"RSI Checklist",    iconType:"material", icon:"checklist",           color:"btn-rsi",       href:"https://ios.niwashibase.com/helpers/rsi_checklist.html", showDefault:true, showShortcuts:true },
  { text:"WAAFELSS",         iconType:"material", icon:"face", color:"btn-waafelss", href:"#", showDefault:true, showShortcuts:true },

  // Row 2 â€” Pediatric Care
  { text:"CCP Pediatric",    iconType:"material", icon:"vaccines",            color:"btn-ccp",       href:"#", showDefault:true, showShortcuts:true, actionId:"ccp" },
  { text:"AP Pediatrics",    iconType:"material", icon:"medication", color:"btn-ap",        href:"#", showDefault:true, showShortcuts:true },
  { text:"Care Tools",       iconType:"material", icon:"widgets",        color:"btn-caretools", href:"#", showDefault:true, showShortcuts:true },
  { text:"Estimated Weight", iconType:"material", icon:"monitor_weight",      color:"btn-weight",    href:"#", showDefault:true, showShortcuts:true },

  // Row 3 â€” Assessment Scores
  { text:"GCS Score",        iconType:"material", icon:"psychology_alt",          color:"btn-gcs",       href:"#", showDefault:true, showShortcuts:true, actionId:"gcs" },
  { text:"APGAR Score",      iconType:"material", icon:"child_care",          color:"btn-apgar",     href:"#", showDefault:true, showShortcuts:true, actionId:"apgar" },
  { text:"SAT Score",        iconType:"material", icon:"syringe",                 color:"btn-sat",       href:"#", showDefault:true, showShortcuts:true },

  // Row 4 â€” Calculators Â· Reference
  { text:"Flowcharts",       iconType:"material", icon:"apps",              color:"btn-flowcharts", href:"#", showDefault:false, showShortcuts:true },
  { text:"RBS Converter",    iconType:"material", icon:"glucose",          color:"btn-rbs",        href:"#", showDefault:true, showShortcuts:true, actionId:"rbs" },
  { text:"CPG Wizard",       iconType:"material", icon:"wand_stars",       color:"btn-cpg",        href:"#", showDefault:false, showShortcuts:true },
  { text:"Calculate MAP",    iconType:"material", icon:"calculate",           color:"btn-map",        href:"#", showDefault:true, showShortcuts:true },

  // Ops / Links
  { text:"AS-Call",          iconType:"material", icon:"call",                color:"btn-ascall",     href:"#", showDefault:false, showShortcuts:true },
  { text:"HOS",              iconType:"material", icon:"local_airport",       color:"btn-hos",        href:"#", showDefault:false, showShortcuts:true },
  { text:"Websites",         iconType:"material", icon:"language",            color:"btn-websites",   href:"https://example.com", showDefault:true, showShortcuts:true }
];


    // âœ… Sections layout (this was missing)
    const SECTIONS = [
      { title: "Resuscitation & Timers", items: ["CPR","RSI Checklist","WAAFELSS"] },
      { title: "Pediatric Care",         items: ["CCP Pediatric","AP Pediatrics","Care Tools","Estimated Weight"] },
      { title: "Assessment Scores",      items: ["GCS Score","APGAR Score","SAT Score"] },
      { title: "Calculators Â· Reference", items: ["Flowcharts","RBS Converter","CPG Wizard","Calculate MAP"] },
      { title: "Ops / Links",            items: ["AS-Call","HOS","Websites"] }
    ];

    /* =========================
         CORE
       ========================= */
    const THEME_KEY = "amb_theme";
    const themeMeta = document.getElementById("theme-color");

    function setThemeColorFromCSS(){
      const bg = getComputedStyle(document.documentElement).getPropertyValue("--bg").trim() || "#0f1115";
      themeMeta.setAttribute("content", bg);
    }
    function applyTheme(val){
      document.documentElement.setAttribute("data-theme", val);
      localStorage.setItem(THEME_KEY, val);
      setThemeColorFromCSS();
    }
    function initTheme(){
      const saved = localStorage.getItem(THEME_KEY) || "auto";
      document.getElementById("themeSelect").value = saved;
      applyTheme(saved);
      if (saved === "auto"){
        const mql = window.matchMedia("(prefers-color-scheme: dark)");
        mql.addEventListener?.("change", setThemeColorFromCSS);
      }
    }

    function buildShortcutsUrl(label){
      const base = `shortcuts://run-shortcut?name=${encodeURIComponent(SHORTCUT_NAME)}&input=text&text=`;
      const payload = `web${SEPARATOR}${label}`;
      return base + encodeURIComponent(payload);
    }

    function openPanel(title){
      document.getElementById("panel-title").textContent = title || "Tool";
      document.getElementById("panel").hidden = false;
      document.body.classList.add("panel-open");
    }
    function closePanel(){
      document.getElementById("panel").hidden = true;
      document.getElementById("panel-body").innerHTML = "";
      document.body.classList.remove("panel-open");
      updateHash({});
    }

    document.addEventListener("DOMContentLoaded", mount);
    function mount(){
      initTheme();
      document.getElementById("themeSelect").addEventListener("change",(e)=>applyTheme(e.target.value));

      const newsEl = document.getElementById("news");
      if (NEWS_MESSAGE && NEWS_MESSAGE.trim() !== ""){ newsEl.textContent = NEWS_MESSAGE.trim(); newsEl.style.display = "block" }

      const toggle = document.getElementById("mode");
      const sectionsEl = document.getElementById("sections");

      const map = new Map(BUTTONS.map(b => [b.text, b]));

      function render(){
        const useShortcuts = toggle.checked;
        sectionsEl.innerHTML = "";

        for (const sec of SECTIONS){
          const items = sec.items
            .map(name => map.get(name))
            .filter(Boolean)
            .filter(btn => useShortcuts ? (btn.showShortcuts !== false) : (btn.showDefault !== false));
          if (!items.length) continue;

          const secEl = document.createElement("section");
          secEl.className = "section";
          const head = document.createElement("div");
          head.className = "section-head";
          head.textContent = sec.title;
          const grid = document.createElement("div");
          grid.className = "grid";

          items.forEach((btn, i) => {
            const id  = (btn.id || btn.text.toLowerCase().replace(/\s+/g,"-")).replace(/[^a-z0-9\-]/gi,"-");
            const href = useShortcuts ? buildShortcutsUrl(btn.text) : (btn.href || "#");

            const a = document.createElement("a");
            a.className = `btn ${btn.color || "c-blue"}`;
            a.id = id;
            a.href = href;
            a.style.animationDelay = `${i*18}ms`;

            const iconHtml =
              btn.iconType === "material"
                ? `<span class="material-symbols-rounded" aria-hidden="true">${btn.icon}</span>`
                : "";

            a.innerHTML = `${iconHtml}<span class="label">${btn.text}</span>`;

            if (!useShortcuts){
              if (btn.actionId){
                a.addEventListener("click", (e) => { e.preventDefault(); runAction(btn.actionId, { title: btn.text }) });
              } else if (!btn.href || btn.href === "#"){
                a.addEventListener("click",(e)=>{ e.preventDefault(); alert("This item has no link yet. Enable Shortcuts Mode or set BUTTONS[].href"); });
              }
            }
            grid.appendChild(a);
          });

          secEl.appendChild(head);
          secEl.appendChild(grid);
          sectionsEl.appendChild(secEl);
        }
      }

      toggle.addEventListener("change", render);
      document.getElementById("panel-back").addEventListener("click", closePanel);
      render();

      // Deep-links (e.g., #tool=gcs)
      const { tool, ...params } = parseHash();
      if (tool) runAction(tool, params);
    }

    // ---------- Router / action loader ----------
    async function runAction(actionId, params = {}) {
      try {
        const ver = Date.now();
        const mod = await import(`./tools/${actionId}.js?dev=${ver}`);
        const mountEl = document.getElementById("panel-body");
        mountEl.innerHTML = "";
        openPanel(params.title || actionId.toUpperCase());
        await mod.run(mountEl, params);
        updateHash({ tool: actionId, ...params });
      } catch (e) {
        alert(`Could not load tool: ${actionId}\n${e.message || e}`);
        console.error(e);
      }
    }

    function parseHash(){
      const h = new URLSearchParams((location.hash||"").replace(/^#/, ""));
      const obj = {}; for (const [k,v] of h.entries()) obj[k]=v; return obj;
    }
    function updateHash(obj){
      const h = new URLSearchParams(obj);
      const s = h.toString();
      history.replaceState(null, "", s ? `#${s}` : location.pathname + location.search);
    }
    window.addEventListener("hashchange", () => {
      const { tool, ...params } = parseHash();
      if (tool) runAction(tool, params);
    });

    // ===== Basic swipe back support =====
    let touchStartX = 0; let touchStartY = 0; const SWIPE_THRESHOLD = 60; const VERTICAL_TOLERANCE = 40;
    document.getElementById("panel-card").addEventListener("touchstart", e => { if (e.touches.length !== 1) return; touchStartX = e.touches[0].clientX; touchStartY = e.touches[0].clientY; });
    document.getElementById("panel-card").addEventListener("touchend", e => { if (e.changedTouches.length !== 1) return; const dx = e.changedTouches[0].clientX - touchStartX; const dy = Math.abs(e.changedTouches[0].clientY - touchStartY); if (dx > SWIPE_THRESHOLD && dy < VERTICAL_TOLERANCE) closePanel(); });

    // ===== iOS-style interactive edge-swipe back =====
    (() => {
      const panel = document.getElementById("panel");
      const card  = document.getElementById("panel-card");
      const content = document.querySelector(".wrap");

      const EDGE_ZONE = 24; const COMPLETE_THRESHOLD = 0.28; const V_TOL = 18; const MIN_H_START = 6;
      let startX = 0, startY = 0, dragging = false, width = 0, lastDx = 0; let raf = 0;
      function setX(x){ card.style.transform = `translateX(${x}px)`; if (content){ const p = Math.min(1, x / (width || 1)); content.style.transform = `translateX(${Math.min(12, 12*p)}px)`; content.style.opacity = String(1 - 0.04*p); } }
      function onStart(e){ if (panel.hidden) return; const t = e.touches && e.touches[0]; if (!t) return; if (t.clientX > EDGE_ZONE) { dragging = false; return; } startX = t.clientX; startY = t.clientY; width = card.clientWidth || window.innerWidth; dragging = true; lastDx = 0; card.style.transition = "none"; if (content) content.style.transition = "none"; }
      function onMove(e){ if (!dragging) return; const t = e.touches && e.touches[0]; if (!t) return; const dx = t.clientX - startX; const dy = Math.abs(t.clientY - startY); if (dy > V_TOL && dx < MIN_H_START) { cancel(); return; } const dragX = Math.max(0, dx); lastDx = dragX; if (dragX > MIN_H_START && dy < V_TOL) e.preventDefault(); if (!raf){ raf = requestAnimationFrame(() => { setX(lastDx); raf = 0; }); } }
      function finishClose(){ card.style.transition = "transform 280ms cubic-bezier(.22,.61,.36,1)"; if (content) content.style.transition = "transform 280ms ease, opacity 280ms ease"; requestAnimationFrame(() => { setX(width); setTimeout(() => { closePanel(); card.style.transition = ""; if (content){ content.style.transition = ""; content.style.transform = ""; content.style.opacity = ""; } setX(0); }, 280); }); }
      function snapBack(){ card.style.transition = "transform 260ms cubic-bezier(.22,.61,.36,1)"; if (content) content.style.transition = "transform 260ms ease, opacity 260ms ease"; requestAnimationFrame(() => { setX(0); setTimeout(() => { card.style.transition = ""; if (content){ content.style.transition = ""; content.style.transform = ""; content.style.opacity = ""; } }, 260); }); }
      function onEnd(){ if (!dragging) return; dragging = false; const shouldClose = lastDx > (width * COMPLETE_THRESHOLD); if (shouldClose) finishClose(); else snapBack(); }
      function cancel(){ dragging = false; snapBack(); }
      card.addEventListener("touchstart", onStart, { passive: true });
      card.addEventListener("touchmove",  onMove,  { passive: false });
      card.addEventListener("touchend",   onEnd,   { passive: true });
      card.addEventListener("touchcancel",cancel,  { passive: true });
    })();
  </script>
</body>
</html>
