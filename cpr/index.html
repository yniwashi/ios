<!doctype html>
<html lang="en">
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>CPR Timer â€” Trial</title>
<style>
/* =========================
   QUICK-TUNE VARIABLES
   ========================= */
/* Palette (dark) */
:root{
  color-scheme: light dark;
  --bg:#0b0d10; --fg:#e9eef3; --muted:#9aa7b3;
  --card:#14181d; --border:#20262d;

  --total-color:#f1f5f9;   /* Total CPR color */
  --cycle-color:#ff4d4d;   /* Cycle (red) */
  --adr-color:#2ea0ff;     /* Adrenaline (blue) */

  /* Button colors */
  --btn-bg:#1a2027; --btn-fg:#e9eef3; --btn-bd:#2b333b;
  --primary:#0f2e39; --primary-bd:#2e89a8; --primary-fg:#e6fbff;
  --danger:#671d1d;  --danger-bd:#9a3333;  --danger-fg:#fff0f0;

  /* Sizing knobs */
  --title-size: clamp(22px, 3.5vw, 36px);
  --total-size: clamp(44px, 7vw, 72px);        /* total timer digits */
  --kpi-digits: clamp(52px, 9vw, 110px);       /* cycle/adrenaline digits */
  --icon-btn: 54px;                             /* play/pause buttons size */
  --actions-gap: 12px;

  --heart-opacity: .28;                         /* heartbeat overlay */
  --log-font: 15px;                             /* log text size */
}
/* Palette (light) */
[data-theme="light"]{
  --bg:#f6f8fc; --fg:#111827; --muted:#4b5563;
  --card:#ffffff; --border:#e5e7eb;
  --btn-bg:#ffffff; --btn-fg:#111827; --btn-bd:#d1d5db;
  --primary:#0b6b82; --primary-bd:#0b6b82; --primary-fg:#ffffff;
  --danger:#b91c1c;  --danger-bd:#991b1b;  --danger-fg:#ffffff;
  --total-color:#111111;
}

/* Base */
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;font-family:system-ui,Segoe UI,Roboto,Arial;background:var(--bg);color:var(--fg)}
a{color:inherit}

.container{max-width:1200px;margin:0 auto;padding:16px}

/* Header bar */
.header{display:grid;grid-template-columns:1fr auto 1fr;align-items:center;gap:12px}
.brand{justify-self:center;font-weight:900;font-size:var(--title-size);letter-spacing:.2px}
.brand .trial{margin-left:8px;color:#8b5cf6;font-weight:800;font-size:.55em;vertical-align:middle;white-space:nowrap}

/* Tiny control chips */
.controls{display:flex;gap:10px;align-items:center;justify-content:flex-start}
.controls.right{justify-content:flex-end}
.chip{display:flex;align-items:center;gap:8px;padding:8px 12px;border-radius:14px;background:var(--card);border:1px solid var(--border);color:var(--muted)}
.chip input[type=number]{width:84px;padding:6px 8px;border-radius:10px;border:1px solid var(--border);background:var(--bg);color:var(--fg)}
.icon-toggle{display:inline-flex;align-items:center;justify-content:center;width:46px;height:46px;border-radius:12px;border:1px solid var(--btn-bd);background:var(--btn-bg);color:var(--fg)}
.icon-toggle svg{width:28px;height:28px}

/* Total timer */
.total{display:flex;flex-direction:column;align-items:center;margin:10px 0 12px}
.total .label{font-size:13px;letter-spacing:.12em;text-transform:uppercase;color:var(--muted);font-weight:900}
.total .digits{font-variant-numeric:tabular-nums;font-family:ui-monospace,Consolas,monospace;font-weight:900;font-size:var(--total-size);color:var(--total-color)}

/* --- Layouts by orientation --- */
.main{display:grid;gap:16px}

/* Portrait: stacked, actions below total */
@media (orientation:portrait){
  .main{grid-template-areas:
    "total"
    "timers"
    "actions"
    "extras";
    grid-template-columns:1fr}
  .timers{grid-area:timers; display:grid; gap:14px}
  /* Two timers side by side when wide enough */
  @media (min-width:460px){
    .timers{grid-template-columns:1fr 1fr}
  }
  /* When very narrow, stack timers */
  @media (max-width:459.9px){
    .timers{grid-auto-rows:auto}
  }
  .actions{grid-area:actions; display:flex; flex-wrap:wrap; gap:var(--actions-gap); justify-content:center}
  .total{grid-area:total}
  .extras{grid-area:extras}
}

/* Landscape: total centered, controls to sides, timers left/right, actions in the middle column */
@media (orientation:landscape){
  .header{grid-template-columns:1fr auto 1fr}
  .main{
    grid-template-areas:
      "total total total"
      "left  actions right"
      "extras extras extras";
    grid-template-columns:1fr minmax(220px, 360px) 1fr;
    align-items:start;
  }
  .total{grid-area:total}
  .left{grid-area:left}
  .right{grid-area:right}
  .actions{grid-area:actions; display:flex; flex-direction:column; gap:var(--actions-gap); align-items:stretch; justify-content:center}
  .extras{grid-area:extras}
}

/* Timer cards */
.timer{background:var(--card);border:1px solid var(--border);border-radius:18px;padding:16px;display:flex;flex-direction:column;align-items:center;justify-content:center;position:relative}
.timer .label{font-size:14px;letter-spacing:.12em;text-transform:uppercase;color:var(--muted);font-weight:900;margin-bottom:4px}
.timer .digits{font-variant-numeric:tabular-nums;font-family:ui-monospace,Consolas,monospace;font-weight:900;font-size:var(--kpi-digits)}
#cycleDigits{color:var(--cycle-color)}
#adrDigits{color:var(--adr-color)}

/* Heart overlay (single big circle) */
.heart-overlay{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;pointer-events:none}
.heart{
  width:70%;aspect-ratio:1;border-radius:50%;
  background: radial-gradient(rgba(255,77,77,var(--heart-opacity)), rgba(179,0,0,0.05));
  animation:beat 0.6s ease-in-out infinite;
}
@keyframes beat{0%{transform:scale(1)}50%{transform:scale(1.16)}100%{transform:scale(1)}}

/* Play/Pause icon buttons */
.icon-row{display:flex;gap:12px;margin-top:12px}
.icon-btn{width:var(--icon-btn);height:var(--icon-btn);border-radius:12px;border:1px solid var(--btn-bd);background:var(--btn-bg);color:var(--fg);display:inline-flex;align-items:center;justify-content:center}
.icon-btn svg{width:26px;height:26px}

/* Action buttons (no card background) */
.actions button{padding:12px 16px;border-radius:12px;border:1px solid var(--btn-bd);background:var(--btn-bg);color:var(--btn-fg);font-weight:700}
.actions .danger{background:var(--danger);border-color:var(--danger-bd);color:var(--danger-fg)}
.actions .primary{background:var(--primary);border-color:var(--primary-bd);color:var(--primary-fg)}

.hidden{display:none!important}

/* Extras (WAAFELSS + Logs) */
.extras{margin-top:8px;display:grid;gap:12px}
.card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:16px}
.wa-title{font-size:20px;font-weight:900;text-align:center;margin-bottom:8px}
.wa-row{display:flex;justify-content:center;align-items:center;gap:8px;margin-bottom:8px}
.wa-row input{width:130px;padding:8px 10px;border-radius:10px;border:1px solid var(--border);background:var(--bg);color:var(--fg)}
.waffles-grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:8px}
@media (max-width:520px){.waffles-grid{grid-template-columns:1fr}}
.wrow{display:flex;gap:8px;align-items:center}
.wtag{min-width:110px;padding:6px 10px;border-radius:10px;border:1px solid var(--border);color:var(--muted)}
.wval{font-weight:800}

.log{max-height:240px;overflow:auto;margin:0;padding-left:20px;font-size:var(--log-font)}
.log li{margin:6px 0}

/* Printing */
@media print{ .header,.controls,.actions,.wa-row{display:none!important} body{background:#fff;color:#000} .timer,.card{border:none} .digits{color:#000} }
</style>

<body>
<div class="container">

  <!-- Header: controls left/right, title centered -->
  <div class="header">
    <div class="controls">
      <div class="chip">Theme
        <button id="themeBtn" class="icon-toggle" title="Theme: Auto">Auto</button>
      </div>
    </div>

    <div class="brand">CPR Timer <span class="trial">Trial Version</span></div>

    <div class="controls right">
      <div class="chip">BPM <input id="bpm" type="number" min="60" max="160" step="1" value="110"></div>
      <button id="muteBtn" class="icon-toggle" title="Beat mute/unmute" aria-pressed="false">
        <!-- speaker big icon -->
        <svg viewBox="0 0 24 24" fill="none"><path d="M3 9v6h4l5 4V5L7 9H3z" stroke="currentColor" stroke-width="2"/><path id="muteX" d="M16 9l5 6M21 9l-5 6" stroke="currentColor" stroke-width="2" opacity="0"/></svg>
      </button>
    </div>
  </div>

  <!-- Total CPR Time -->
  <div class="total">
    <div class="label">TOTAL CPR TIME</div>
    <div id="totalDigits" class="digits">00:00</div>
  </div>

  <!-- Main area switches layout with orientation -->
  <div class="main">

    <!-- Left: Adrenaline (landscape) / One of two (portrait) -->
    <div class="timer left">
      <div class="label">ADRENALINE</div>
      <div id="adrDigits" class="digits">00:00</div>
      <div class="icon-row">
        <button id="adrStart" class="icon-btn" title="Start/Resume Adrenaline">
          <svg viewBox="0 0 24 24" fill="none"><path d="M8 5v14l11-7-11-7z" stroke="currentColor" stroke-width="2"/></svg>
        </button>
        <button id="adrPause" class="icon-btn" title="Pause Adrenaline" disabled>
          <svg viewBox="0 0 24 24" fill="none"><path d="M7 5h4v14H7zM13 5h4v14h-4z" stroke="currentColor" stroke-width="2"/></svg>
        </button>
      </div>
    </div>

    <!-- Actions center in landscape, below total in portrait -->
    <div class="actions">
      <div style="display:flex;gap:var(--actions-gap);justify-content:center;flex-wrap:wrap">
        <button id="roscb" class="danger">ROSC</button>
        <button id="stopb" class="danger">Stop</button>
      </div>
      <div style="display:flex;gap:var(--actions-gap);justify-content:center;flex-wrap:wrap">
        <button id="shockb">Shock</button>
        <button id="amiob" class="primary">Amiodarone</button>
      </div>
    </div>

    <!-- Right: Cycle -->
    <div class="timer right">
      <div class="label">CYCLE</div>
      <div id="cycleDigits" class="digits">00:00</div>
      <div class="heart-overlay"><div id="heart" class="heart"></div></div>
      <div class="icon-row">
        <button id="cprStart" class="icon-btn" title="Start/Resume CPR">
          <svg viewBox="0 0 24 24" fill="none"><path d="M8 5v14l11-7-11-7z" stroke="currentColor" stroke-width="2"/></svg>
        </button>
        <button id="cprPause" class="icon-btn" title="Pause CPR" disabled>
          <svg viewBox="0 0 24 24" fill="none"><path d="M7 5h4v14H7zM13 5h4v14h-4z" stroke="currentColor" stroke-width="2"/></svg>
        </button>
      </div>
    </div>

    <!-- Extras (below fold) -->
    <div class="extras">
      <div class="card">
        <div class="wa-title">WAAFELSS</div>
        <div class="wa-row">
          <input id="age" type="number" min="0" placeholder="Enter age">
          <button id="mBtn" class="icon-btn" title="Months">
            <svg viewBox="0 0 24 24" fill="none"><path d="M4 12h16" stroke="currentColor" stroke-width="2"/></svg>
          </button>
          <button id="yBtn" class="icon-btn" title="Years">
            <svg viewBox="0 0 24 24" fill="none"><path d="M4 12h16M12 4v16" stroke="currentColor" stroke-width="2"/></svg>
          </button>
        </div>
        <div class="waffles-grid">
          <div class="wrow"><div class="wtag">Age</div><div id="wAge" class="wval">â€”</div></div>
          <div class="wrow"><div class="wtag">Weight</div><div id="wWeight" class="wval">â€”</div></div>
          <div class="wrow"><div class="wtag">Adrenaline</div><div id="wAdr" class="wval">â€”</div></div>
          <div class="wrow"><div class="wtag">Amiodarone</div><div id="wAmio" class="wval">â€”</div></div>
          <div class="wrow"><div class="wtag">Fluids</div><div id="wFluids" class="wval">â€”</div></div>
          <div class="wrow"><div class="wtag">SGA</div><div id="wSGA" class="wval">â€”</div></div>
          <div class="wrow"><div class="wtag">Energy</div><div id="wJoules" class="wval">â€”</div></div>
          <div class="wrow"><div class="wtag">D10%</div><div id="wD10" class="wval">â€”</div></div>
        </div>
      </div>

      <div class="card">
        <div style="display:flex;gap:10px;justify-content:center;margin-bottom:8px">
          <button id="exportTxt">Export .txt</button>
          <button id="printPdf">Print (PDF)</button>
        </div>
        <ul id="log" class="log"></ul>
      </div>
    </div>
  </div><!-- /main -->
</div><!-- /container -->

<script>
(() => {
  /* ---------- THEME ---------- */
  const root = document.documentElement;
  const themeBtn = document.getElementById('themeBtn');
  let themeMode = 'auto'; // auto | light | dark
  function applyTheme(){
    root.removeAttribute('data-theme');
    if (themeMode==='light') root.setAttribute('data-theme','light');
    if (themeMode==='dark')  root.setAttribute('data-theme','dark');
    themeBtn.textContent = themeMode[0].toUpperCase()+themeMode.slice(1);
    themeBtn.title = `Theme: ${themeBtn.textContent}`;
  }
  themeBtn.addEventListener('click', () => {
    themeMode = themeMode==='auto' ? 'light' : themeMode==='light' ? 'dark' : 'auto';
    applyTheme();
  });
  applyTheme();

  /* ---------- HELPERS ---------- */
  const $ = id => document.getElementById(id);
  const fmt = s => { s=Math.max(0,Math.floor(s)); const m=String((s/60|0)).padStart(2,'0'); return `${m}:${String(s%60).padStart(2,'0')}`; };
  const hhmmss = d => d.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit', second:'2-digit'}); // 24h obeys device
  const logEl = $('log');
  const events = [];
  function stamp(label){
    const ts=new Date();
    const li=document.createElement('li');
    li.textContent=`${hhmmss(ts)} | ${label}`;
    logEl.prepend(li);
    events.push({ts,label});
  }

  /* ---------- WAKE LOCK ---------- */
  let wakeLock=null;
  async function requestWake(){try{ if('wakeLock' in navigator){wakeLock=await navigator.wakeLock.request('screen');}}catch{}}
  async function releaseWake(){try{ if(wakeLock){await wakeLock.release(); wakeLock=null;}}catch{}}
  document.addEventListener('visibilitychange', ()=>{ if(document.visibilityState==='visible' && (cprRunning||adrRunning)) requestWake(); });

  /* ---------- AUDIO ---------- */
  let audioCtx;
  const buffers={}, files={
    beat:'beat.wav', start:'start.wav', pause:'pause.wav', stop:'stop.wav',
    adr4:'adr4.wav', total20:'total20.wav', cpr90:'cpr90.wav', cpr120:'cpr120.wav', rosc:'rosc.wav'
  };
  async function ensureAudio(){
    if(!audioCtx) audioCtx=new (window.AudioContext||window.webkitAudioContext)();
    await audioCtx.resume();
    if(!buffers._loaded){
      for(const [k,p] of Object.entries(files)){
        try{ const b=await fetch(p).then(r=>r.arrayBuffer()); buffers[k]=await audioCtx.decodeAudioData(b); }catch{}
      }
      buffers._loaded=true;
    }
  }
  function play(name, vol=1){
    const buf=buffers[name]; if(!audioCtx || !buf) return;
    const src=audioCtx.createBufferSource(), g=audioCtx.createGain();
    g.gain.value=vol; src.buffer=buf; src.connect(g).connect(audioCtx.destination); src.start();
  }

  /* Beat (only this is muted) */
  let beatMuted=false, beatTimer=null, bpm=+$('bpm').value||110;
  $('bpm').addEventListener('change',e=>{ bpm=+e.target.value||110; setHeart(bpm); if(cprRunning) restartBeat(); });
  function startBeat(){ clearInterval(beatTimer); if(beatMuted) return; const iv=Math.max(200,60000/Math.max(1,bpm)); beatTimer=setInterval(()=>play('beat',0.95),iv); }
  function stopBeat(){ clearInterval(beatTimer); beatTimer=null; }
  function restartBeat(){ stopBeat(); startBeat(); }
  const muteBtn=$('muteBtn'), muteX=document.getElementById('muteX');
  muteBtn.addEventListener('click',()=>{ beatMuted=!beatMuted; muteX.style.opacity=beatMuted?'1':'0'; if(beatMuted) stopBeat(); else if(cprRunning) startBeat(); });

  /* Heart BPM */
  const heart=$('heart');
  function setHeart(b){ heart.style.animationDuration = Math.max(0.25, 60/Math.max(1,b))+'s'; }
  setHeart(bpm);

  /* ---------- STATE ---------- */
  let totalStart=0,totalEnd=0;      // total CPR (does not pause)
  let cprStart=0,cprPausedAt=0,cprPausedAccum=0,cprRunning=false;
  let adrStart=0,adrPausedAt=0,adrPausedAccum=0,adrRunning=false,adrCount=0;
  // cues
  let cue20=false, cue90=false, cue120=false, cueAdr240=false;

  /* ---------- LOOP ---------- */
  function now(){ return Date.now(); }
  function tick(){
    const t=now();

    // total
    if(totalStart && !totalEnd){ $('totalDigits').textContent=fmt((t-totalStart)/1000); if(!cue20 && (t-totalStart)>=20*60000){ cue20=true; play('total20'); } }
    else if(totalStart && totalEnd){ $('totalDigits').textContent=fmt((totalEnd-totalStart)/1000); }
    else $('totalDigits').textContent='00:00';

    // cycle (pauses on pause)
    let c=0;
    if(cprStart){
      if(cprRunning) c=(t-cprStart-cprPausedAccum)/1000;
      else if(cprPausedAt) c=(cprPausedAt-cprStart-cprPausedAccum)/1000;
      else if(totalEnd) c=(totalEnd-cprStart-cprPausedAccum)/1000;
      $('cycleDigits').textContent=fmt(c|0);
      if(!cue90 && c>=90){ cue90=true; play('cpr90'); }
      if(!cue120 && c>=120){ cue120=true; play('cpr120'); }
    }else{
      $('cycleDigits').textContent='00:00';
    }

    // adrenaline
    if(adrStart){
      let a=0;
      if(adrRunning) a=(t-adrStart-adrPausedAccum)/1000;
      else if(adrPausedAt) a=(adrPausedAt-adrStart-adrPausedAccum)/1000;
      else if(totalEnd) a=(totalEnd-adrStart-adrPausedAccum)/1000;
      $('adrDigits').textContent=fmt(a|0);
      if(!cueAdr240 && a>=240){ cueAdr240=true; play('adr4'); }
    }else $('adrDigits').textContent='00:00';

    requestAnimationFrame(tick);
  }
  requestAnimationFrame(tick);

  /* ---------- CONTROLS ---------- */
  $('cprStart').onclick = async () => {
    await ensureAudio();
    if(!totalStart){ totalStart=now(); stamp('CPR Timer Started'); requestWake(); }
    if(!cprStart){ cprStart=totalStart; cprPausedAccum=0; cue90=cue120=false; play('start'); }
    else if(cprPausedAt){ cprPausedAccum += (now()-cprPausedAt); cprPausedAt=0; play('start'); stamp('CPR Timer Resumed'); }
    totalEnd=0; cprRunning=true; $('cprPause').disabled=false; if(!beatMuted) startBeat();
  };
  $('cprPause').onclick = async () => {
    if(!cprRunning) return;
    await ensureAudio();
    cprRunning=false; cprPausedAt=now(); play('pause'); stamp('CPR Timer Paused'); stopBeat();
  };

  $('adrStart').onclick = async () => {
    await ensureAudio();
    if(!totalStart) $('cprStart').click(); // QoL
    if(!adrStart){ adrStart=now(); adrPausedAccum=0; adrPausedAt=0; adrRunning=true; adrCount++; cueAdr240=false; stamp(`Adrenaline no. ${adrCount} Administered`); stamp('Adrenaline Timer Started'); }
    else if(adrPausedAt){ adrPausedAccum += (now()-adrPausedAt); adrPausedAt=0; adrRunning=true; stamp('Adrenaline Timer Resumed'); }
    $('adrPause').disabled=false;
  };
  $('adrPause').onclick = () => {
    if(!adrRunning) return;
    adrRunning=false; adrPausedAt=now(); stamp('Adrenaline Timer Paused');
  };

  $('stopb').onclick = async () => {
    await ensureAudio(); play('stop');
    if(!totalStart) return;
    totalEnd=now();
    if(cprRunning){ cprRunning=false; cprPausedAt=0; }
    if(adrRunning){ adrRunning=false; adrPausedAt=0; }
    stamp('CPR Timers Reset'); stopBeat(); releaseWake();
  };
  $('roscb').onclick = async () => { await ensureAudio(); play('rosc'); stamp('ROSC Achieved'); };

  $('shockb').onclick = () => { window.__shock=(window.__shock||0)+1; stamp(`Shock no. ${window.__shock} Delivered`); };
  $('amiob').onclick  = () => { window.__amio =(window.__amio ||0)+1; stamp(`Amiodarone no. ${window.__amio} Administered`); };

  /* ---------- EXPORT & PRINT ---------- */
  function lines(){
    const started = totalStart ? new Date(totalStart).toLocaleString() : 'N/A';
    const ended   = totalEnd   ? new Date(totalEnd).toLocaleString()   : 'N/A';
    const total   = (totalStart && totalEnd) ? fmt((totalEnd-totalStart)/1000) : 'â€”';
    const counts  = `Adr: ${adrCount}; Shocks: ${window.__shock||0}; Amio: ${window.__amio||0}`;
    const arr=[`CPR SESSION REPORT`,`Started: ${started}`,`Ended:   ${ended}`,`BPM (visual beat): ${bpm}`,`Total: ${total}`,counts,``,`Events:`];
    for(const e of events) arr.push(`${hhmmss(e.ts)} | ${e.label}`);
    return arr;
  }
  $('exportTxt').onclick = () => {
    const blob = new Blob([lines().join('\n')], {type:'text/plain'});
    const a=document.createElement('a'); a.href=URL.createObjectURL(blob);
    a.download=`cpr_report_${new Date().toISOString().replace(/[:.]/g,'-')}.txt`; a.click();
  };
  $('printPdf').onclick = () => {
    const html = `<!doctype html><meta charset="utf-8"><title>CPR Report</title>
    <style>body{font-family:system-ui,Segoe UI,Roboto,Arial;margin:24px;color:#111} h2{margin:0 0 8px} pre{white-space:pre-wrap}</style>
    <h2>CPR Session Report</h2><pre>${lines().join('\n')}</pre>
    <script>onload=()=>{print();setTimeout(()=>close(),300)}<\/script>`;
    const w=window.open('','printwin'); w.document.open(); w.document.write(html); w.document.close();
  };

  /* ---------- WAAFELSS ---------- */
  const age=$('age'), mBtn=$('mBtn'), yBtn=$('yBtn');
  function clamp(v,a,b){return Math.max(a,Math.min(b,v));}
  function months(n){
    const weight=n*0.5+4, adr=+(weight*0.01).toFixed(2), amio=+(weight*5).toFixed(1);
    const minF=Math.round(weight*10), maxF=Math.round(weight*20);
    const joules=Math.round(clamp(weight*4,0,360)), d10=+(clamp(weight*2.5,0,50)).toFixed(1);
    const sga=(weight<=5)?'Size 1':'Size 1.5';
    return {age:`${n} months`,weight,adr,amio,minF,maxF,sga,joules,d10};
  }
  function years(n){
    let weight,sga; if(n<=5){weight=n*2+8; sga=(weight>=10&&weight<=24)?'Size 2':(weight>=25&&weight<=35)?'Size 2.5':'';}
    else{weight=n*3+7; sga=(weight>=25&&weight<=35)?'Size 2.5':'Consider adult SGA sizes';}
    const adr=+(weight*0.01).toFixed(2), amio=+(weight*5).toFixed(1);
    const minF=Math.round(weight*10), maxF=Math.round(weight*20);
    const joules=Math.round(clamp(weight*4,0,360)), d10=+(clamp(weight*2.5,0,50)).toFixed(1);
    return {age:`${n} years`,weight,adr,amio,minF,maxF,sga,joules,d10};
  }
  function renderW(o){
    $('wAge').textContent=o.age;
    $('wWeight').textContent=`${o.weight.toFixed(1)} kg`;
    $('wAdr').textContent=`${o.adr} mg`;
    $('wAmio').textContent=`${o.amio} mg`;
    $('wFluids').textContent=`${o.minF}â€“${o.maxF} mL`;
    $('wSGA').textContent=o.sga||'â€”';
    $('wJoules').textContent=`${o.joules} J`;
    $('wD10').textContent=`${o.d10} mL`;
  }
  function validAge(){ const n=+age.value; return !(isNaN(n) || n<0); }
  mBtn.onclick = ()=>{ if(!validAge()){ alert('Enter age first'); return; } renderW(months(+age.value)); };
  yBtn.onclick = ()=>{ if(!validAge()){ alert('Enter age first'); return; } renderW(years(+age.value)); };

})();
</script>
</body>
</html>
